# Лабораторная работа 4
## Тема: Знакомство с Redis

**Цель:** Изучение основ взаимодействия с резидентной No-SQL СУБД Redis. Знакомство с основными структурами хранения  данных Redis. 

### 1. Основы Redis

Redis (Remote Dictionary Service) — это опенсорсный сервер баз данных типа ключ-значение. Точнее всего описать Redis можно, сказав, что это — сервер структур данных.

Redis хранит данные в виде словаря, в котором ключи связаны со значениями.

Поддерживаются следующие абстрактные типы данных: строки, списки, множества, хеш-таблицы, упорядоченные множества.

#### Применение Redis

- Кеширование данных: Redis широко используется для кеширования данных, что помогает ускорить доступ к информации. Он позволяет хранить результаты запросов, результаты вычислений и другие данные в памяти, чтобы они были доступны сразу же и не требовали повторных вычислений или запросов к базе данных.
- Очереди сообщений: Redis может быть использован в качестве системы очередей сообщений, где он служит для сохранения, обработки и доставки сообщений.
- Публикация/подписка: Redis имеет возможность создания системы публикации и подписки, где клиенты могут подписываться на определенные каналы и получать уведомления о событиях, происходящих в этих каналах. Это позволяет эффективно организовывать обмен сообщениями между компонентами системы и реагировать на события в режиме реального времени.


### 2. Запуск Redis через Docker и подключение к нему

```bash
docker run --name redis –d redis:latest
docker exec –it redis sh
```

- Первая команда запустит контейнер с образом redis
- Вторая команда предоставит sh-оболочку контейнера с redis

Для работы с Redis существует консольная утилита. Для того, чтобы подключиться к локальной базе данных, никаких параметров указывать не нужно.
```bash
redis-cli
```
Для подключения к удалённой базе данных необходимо указать ip-адрес хоста и порт. Портом по умолчанию для Redis является 6379.
```bash
redis-cli –h 10.11.12.13 –p 6379
```
Если redis-cli не установлен, его можно установить вышеуказанной командой. Для docker-образа установка redis-cli не требуется.
```bash
sudo apt install –y redis-tools
```


### 3. Начало работы в redis-cli

#### PING
После входа в интерфейс redis-cli для проверки работоспособности программы можно ввести команду `PING`
```
# redis-cli
127.0.0.1:6379> PING
PONG
127.0.0.1:6379>
```

#### AUTH
Команда `PING` может выдать ошибку при входе на удалённый сервер. Необходимо произвести аутентификацию, после чего повторить команду `PING`. Аутентификация производится командой `AUTH`. 
```
127.0.0.1:6379> AUTH my_secret_password
```

#### SELECT
Для выбора базы данных для работы существует команда `SELECT`. После этой команды указывается номер базы данных, к которой вы хотите подключиться. По умолчанию в Redis номера баз данных 0-15.
```
127.0.0.1:6379> SELECT 4
OK
127.0.0.1:6379[4]>
```


### 4. Строковые команды

Установка ключа со значением
```
SET key value
```
Получение значения по ключу
```
GET key
```
**Пример:**
```
127.0.0.1:6379> SET student Bob
OK
127.0.0.1:6379> GET student
"Bob"
```
---
Получение текущего значения и установка нового
```
GETSET key value
```
Добавление значение к строке
```
APPEND key value
```
**Пример:**
```
127.0.0.1:6379> GETSET student Mike
"Bob"
127.0.0.1:6379> APPEND student " Smith"
(integer) 10
127.0.0.1:6379> GET student
"Mike Smith"
127.0.0.1:6379>
```
---
Числа в Redis хранятся как строки!!!!!!!! Но с ними можно делать математические операции – например инкремент и декремент. При применении этих операций не к числам произойдёт ошибка.
```
INCR key
DECR key
```
**Пример:**
```
127.0.0.1:6379> SET num 1
OK
127.0.0.1:6379> INCR num
(integer) 2
127.0.0.1:6379> INCR num
(integer) 3
127.0.0.1:6379> DECR num
(integer) 2
```
---
Получить все ключи в базе данных
```
KEYS *
```
Удаление значения по ключу
```
DEL key
```
Удаление всех ключей в базе данных / во всём redis
```
FLUSHDB
FLUSHALL
```


### 5. Списки

Запись в начало массива
```
LPUSH key value
```
Запись в конец массива
```
RPUSH key value
```
Если массива по такому ключу ещё нет, он создастся автоматически

**Пример:**
```
127.0.0.1:6379> LPUSH cars Lada
(integer) 1
127.0.0.1:6379> RPUSH cars BMW
(integer) 2
127.0.0.1:6379> LPUSH cars Honda
(integer) 3
```
---
Вывод элементов массива. start – начиная с какого элемента. stop – заканчивая каким элементом.
```
LRANGE key start stop
```
**Пример:**
```
127.0.0.1:6379> LRANGE cars 0 -1
1) "Honda"
2) "Lada"
3) "BMW"
127.0.0.1:6379> LRANGE cars 0 0
1) "Honda"
127.0.0.1:6379> LRANGE cars 1 2
1) "Lada"
2) "BMW"
```
---
Длинна массива
```
LLEN key
```
**Пример:**
```
127.0.0.1:6379> LLEN cars
(integer) 3
```
---
Получение элемента с начала массива / с конца массива
```
LPOP key
RPOP key
```
**Пример:**
```
127.0.0.1:6379> LRANGE cars 0 -1
1) "Honda"
2) "Lada"
3) "BMW"
127.0.0.1:6379> LPOP cars
"Honda"
127.0.0.1:6379> RPOP cars
"BMW"
127.0.0.1:6379> LRANGE cars 0 -1
1) "Lada"
127.0.0.1:6379>
```


### 6. Множества

Добавление значений в сет
```
SADD key value
```
Получение элементов сета
```
SMEMBERS
```
**Пример:**
```
127.0.0.1:6379> SADD products Milk Apple Cheese Tomato
(integer) 4
127.0.0.1:6379> SMEMBERS products
1) "Milk"
2) "Apple"
3) "Cheese"
4) "Tomato"
127.0.0.1:6379> SADD products Milk
(integer) 0
```
---
Пересечение / объединение / вычитание множеств
```
SINTER key1 key2
SUNION key1 key2
SDIFF key1 key2
```
Количество элементов во множестве
```
SCARD key
```
**Пример:**
```
127.0.0.1:6379> SADD have_products Apple
(integer) 1
127.0.0.1:6379> SDIFF products have_products
1) "Milk"
2) "Cheese"
3) "Tomato"
127.0.0.1:6379> SCARD products
(integer) 4
```


### 7. Коллекции

Добавление элемента в коллекцию
```
HSET key field value
```
**Пример:**
```
127.0.0.1:6379> HSET pet name Bobik
(integer) 1
127.0.0.1:6379> HSET pet age 10 type Dog
(integer) 2
```
---
Получение значение конкретного поля коллекции
```
HGET key field
```
Получение значения всех полей и значений коллекции
```
HGETALL key
```
Получение всех полей/значений коллекции
```
HKEYS key
HVALS key
```
**Пример:**
```
127.0.0.1:6379> HGET pet name
"Bobik"
127.0.0.1:6379> HGETALL pet
1) "name"
2) "Bobik"
3) "age"
4) "10"
5) "type"
6) "Dog"
```

### 8. Упорядоченные множества

Добавление элемента в коллекцию
```
ZADD key score member
```
Получение значения элементов коллекции. Все элементы упорядочиваются по score
```
ZRANGE key start stop
```
**Пример:**
```
127.0.0.1:6379> ZADD winners 3 Alice 1 Ron 2 John
(integer) 3
127.0.0.1:6379> ZRANGE winners 0 -1
1) "Ron"
2) "John"
3) "Alice"
```
---
Получение значения элементов коллекции с местами в ней
```
ZRANGE key start stop WITHSCORES
```
Получение позиции (индекса) элемента в коллекции
```
ZRANK key member
```
Удаление элемента из коллекции
```
ZREM key member
```
**Пример:**
```
127.0.0.1:6379> ZRANGE winners 0 -1 WITHSCORES
1) "Ron"
2) "1"
3) "John"
4) "2"
5) "Alice"
6) "3"
127.0.0.1:6379> ZRANK winners John
(integer) 1
127.0.0.1:6379> ZREM winners Alice
(integer) 1
127.0.0.1:6379> ZRANGE winners 0 -1
1) "Ron"
2) "John"
```


### 9. Модель издатель-подписчик

Подписка на канал для получения сообщений
```
SUBSCRIBE channel
```
**Пример:**
```
127.0.0.1:6379> SUBSCRIBE news
1) "subscribe"
2) "news"
3) (integer) 1
.........
# Когда в канал опубликовано новое сообщение
1) "message"
2) "news"
3) "Hello, I have some news!!!"
```
---
Отправка в канал сообщения
```
PUBLISH channel message
```
**Пример:**
```
127.0.0.1:6379> PUBLISH news "Hello, I have some news!!!"
(integer) 1
```

### Индивидуальное задание

1.	Установить redis-cli для подключения к удалённому серверу Redis или развернуть Redis локально.
2.	Проверить установленное подключение командой PING.
3.	При возникновении ошибки - авторизоваться и повторить проверку.
4.	Выбрать базу данных для работы по номеру из списка группы.
5.	Записать в бд строку с ключом student и значением – своим ФИО (латиницей).
6.	Получить из бд значение по ключу student.
7.	Добавить к текущему значению вашу группу.
8.	Создать любое числовое значение и проинкрементировать его.
9.	Удалить числовое значение.
10.	Создать список из 8 наименований, связанных с вашей предметной областью (на английском языке).
11.	Показать список целиком. Потом показать только 4 элемента посередине.
12.	Удалить из списка первый элемент.
13.	Создать два множества из 5 элементов. Заполнить их числами.
14.	Вывести содержимое обоих множеств.
15.	Вывести только те элементы, которые содержатся в 1 множестве и отсутствуют во втором.
16. Вывести элементы, одинаковые в обоих множествах.
17. Вывести элементы, присутствующие в обоих множествах.
18. Показать длину множества.
19.	Создать коллекцию, содержащую 1 элемент по вашей предметной области. Вводить значения на английском – русский язык выводится не в той кодировке. Массивы и объекты записать в этот элемент как строки.
20.	Вывести 1 любое значение из коллекции по ключу.
21.	Вывести все ключи и значения коллекции.
22.	Продемонстрировать модель издатель-подписчик.
